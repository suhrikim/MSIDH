.intel_syntax noprefix

.section .rodata

.global uintbig_1
uintbig_1:
    .quad 1, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0


.global uintbig_0
uintbig_0:
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0
    .quad 0, 0, 0, 0


.global uintbig_a
uintbig_a:
.quad 0x3adaacdb371d761c, 0x81a6d69612b6abb2, 0x6e92e91658e824d1, 0xc8777241584ddacf
.quad 0x7848edaf58cb939b, 0xbf2cbc3b2a6832ed, 0xcf08aff1824c0eb0, 0xae6a86cdc639dcbb
.quad 0xbcd2bc8f7f4ca66a, 0xe1c021ed2ec6dd21, 0x25380a162e805736, 0x4e2884057f20875b
.quad 0x4bf3a3ac381a82b9, 0x1c1eb9925eb890ca, 0x58d3cb4643c75c20, 0x845de829a4fc51fa
.quad 0xef42e15697e85d2f, 0x1bd44bcc0c221c23, 0x0354446ac34fb5ab, 0x74799cada2efbb2b
.quad 0x669fee867d1e116e, 0xf5bdaa67cbdf94cf, 0xfa06bfb20cfe87b0, 0x2af926de02df4158
.quad 0xb152da9a65e2b386, 0x5233c9f7cc10fffd, 0x6bbc1476695f8959, 0x137866a6a10e708a
.quad 0xed8b336582832861, 0xa2592b728cb9336c, 0xa6b66cbfdcee879d, 0x700f94189518d3f7
.quad 0x0000000000000009, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000
.quad 0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000
.quad 0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000
.quad 0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000
.quad 0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000
.quad 0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000
.quad 0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000
.quad 0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000

.global uintbig_b
uintbig_b:
.quad 0x2ea11fe940c2a635, 0x713bf6bb9c9025fc, 0x0d128fec4b8b1b30, 0xd11c5a2fd8e28c24
.quad 0xb4c16d55a35342cf, 0xc801b7fe28aadd94, 0xa3a67cbb4de8d17f, 0x1592c9410108bc6e
.quad 0x68f22b2cbb51d2d9, 0xf6e7cb2c69e96670, 0xddf8135f544ccd00, 0xea8ee775ebcc1d25
.quad 0x115afb41656e7dbd, 0xdba5bc33eaa09690, 0xf1f5be5020cb3def, 0x09dbb1fa18039fd3
.quad 0x8e44e235028f299b, 0x9f4c20225f4d202e, 0xb4d25693eabba3b6, 0xfbe727994950e5e2
.quad 0x2b01401d140b4d92, 0xd3a9f983fb3a0493, 0x3ef6b1ec285a2807, 0xc01e2dcc4a24a225
.quad 0xbb20d4ea1541deda, 0x4ae38136073b1444, 0xce73ddcc85c3f40b, 0x5d5436ea18a14cb8
.quad 0x5c27095879f2cd90, 0x0649e972da020a06, 0xfe54118cac0a633b, 0x0a0261d5f6cc12eb
.quad 0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000
.quad 0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000
.quad 0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000
.quad 0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000
.quad 0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000
.quad 0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000
.quad 0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000
.quad 0x0000000000000000, 0x0000000000000000, 0x0000000000000000, 0x0000000000000000


.section .text

.global uintbig_set
uintbig_set:
    cld
    mov rax, rsi
    stosq
    xor rax, rax
    mov rcx, 63
    rep stosq
    ret


.global uintbig_bit
uintbig_bit:
    mov rcx, rsi
    and rcx, 0x3f
    shr rsi, 6
    mov rax, [rdi + 8*rsi]
    shr rax, cl
    and rax, 1
    ret


.global uintbig_add3
uintbig_add3:
    mov rax, [rsi +  0]
    add rax, [rdx +  0]
    mov [rdi +  0], rax
    .set k, 1
    .rept 63
        mov rax, [rsi + 8*k]
        adc rax, [rdx + 8*k]
        mov [rdi + 8*k], rax
        .set k, k+1
    .endr
    setc al
    movzx rax, al
    ret

.global uintbig_sub3
uintbig_sub3:
    mov rax, [rsi +  0]
    sub rax, [rdx +  0]
    mov [rdi +  0], rax
    .set k, 1
    .rept 63
        mov rax, [rsi + 8*k]
        sbb rax, [rdx + 8*k]
        mov [rdi + 8*k], rax
        .set k, k+1
    .endr
    setc al
    movzx rax, al
    ret


.global uintbig_mul3_64
uintbig_mul3_64:

    mulx r10, rax, [rsi +  0]
    mov [rdi +  0], rax

    mulx r11, rax, [rsi +  8]
    add  rax, r10
    mov [rdi +  8], rax

    mulx r10, rax, [rsi + 16]
    adcx rax, r11
    mov [rdi + 16], rax

    mulx r11, rax, [rsi + 24]
    adcx rax, r10
    mov [rdi + 24], rax

    mulx r10, rax, [rsi + 32]
    adcx rax, r11
    mov [rdi + 32],rax

    mulx r11, rax, [rsi + 40]
    adcx rax, r10
    mov [rdi + 40],rax

    mulx r10, rax, [rsi + 48]
    adcx rax, r11
    mov [rdi + 48],rax

    mulx r11, rax, [rsi + 56]
    adcx rax, r10
    mov [rdi + 56],rax

    mulx r10, rax, [rsi + 64]
    adcx rax, r11
    mov [rdi + 64],rax

    mulx r11, rax, [rsi + 72]
    adcx rax, r10
    mov [rdi + 72],rax

    mulx r10, rax, [rsi + 80]
    adcx rax, r11
    mov [rdi + 80],rax

    mulx r11, rax, [rsi + 88]
    adcx rax, r10
    mov [rdi + 88],rax

    mulx r10, rax, [rsi + 96]
    adcx rax, r11
    mov [rdi + 96],rax

    mulx r11, rax, [rsi + 104]
    adcx rax, r10
    mov [rdi + 104],rax

    mulx r10, rax, [rsi + 112]
    adcx rax, r11
    mov [rdi + 112],rax

    mulx r11, rax, [rsi + 120]
    adcx rax, r10
    mov [rdi + 120],rax

    mulx r10, rax, [rsi + 128]
    adcx rax, r11
    mov [rdi + 128],rax

    mulx r11, rax, [rsi + 136]
    adcx rax, r10
    mov [rdi + 136],rax


    mulx r10, rax, [rsi + 144]
    adcx rax, r11
    mov [rdi + 144],rax

    mulx r11, rax, [rsi + 152]
    adcx rax, r10
    mov [rdi + 152],rax


    mulx r10, rax, [rsi + 160]
    adcx rax, r11
    mov [rdi + 160],rax

    mulx r11, rax, [rsi + 168]
    adcx rax, r10
    mov [rdi + 168],rax


    mulx r10, rax, [rsi + 176]
    adcx rax, r11
    mov [rdi + 176],rax

    mulx r11, rax, [rsi + 184]
    adcx rax, r10
    mov [rdi + 184],rax


    mulx r10, rax, [rsi + 192]
    adcx rax, r11
    mov [rdi + 192],rax

    mulx r11, rax, [rsi + 200]
    adcx rax, r10
    mov [rdi + 200],rax


    mulx r10, rax, [rsi + 208]
    adcx rax, r11
    mov [rdi + 208],rax

    mulx r11, rax, [rsi + 216]
    adcx rax, r10
    mov [rdi + 216],rax


    mulx r10, rax, [rsi + 224]
    adcx rax, r11
    mov [rdi + 224],rax

    mulx r11, rax, [rsi + 232]
    adcx rax, r10
    mov [rdi + 232],rax

    mulx r10, rax, [rsi + 240]
    adcx rax, r11
    mov [rdi + 240],rax

    mulx r11, rax, [rsi + 248]
    adcx rax, r10
    mov [rdi + 248],rax


    mulx r10, rax, [rsi + 256]
    adcx rax, r11
    mov [rdi + 256],rax

    mulx r11, rax, [rsi + 264]
    adcx rax, r10
    mov [rdi + 264],rax

    mulx r10, rax, [rsi + 272]
    adcx rax, r11
    mov [rdi + 272],rax

    mulx r11, rax, [rsi + 280]
    adcx rax, r10
    mov [rdi + 280],rax

    mulx r10, rax, [rsi + 288]
    adcx rax, r11
    mov [rdi + 288],rax

    mulx r11, rax, [rsi + 296]
    adcx rax, r10
    mov [rdi + 296],rax

    mulx r10, rax, [rsi + 304]
    adcx rax, r11
    mov [rdi + 304],rax

    mulx r11, rax, [rsi + 312]
    adcx rax, r10
    mov [rdi + 312],rax


    mulx r10, rax, [rsi + 320]
    adcx rax, r11
    mov [rdi + 320],rax

    mulx r11, rax, [rsi + 328]
    adcx rax, r10
    mov [rdi + 328],rax

    mulx r10, rax, [rsi + 336]
    adcx rax, r11
    mov [rdi + 336],rax

    mulx r11, rax, [rsi + 344]
    adcx rax, r10
    mov [rdi + 344],rax

    mulx r10, rax, [rsi + 352]
    adcx rax, r11
    mov [rdi + 352],rax

    mulx r11, rax, [rsi + 360]
    adcx rax, r10
    mov [rdi + 360],rax

    mulx r10, rax, [rsi + 368]
    adcx rax, r11
    mov [rdi + 368],rax

    mulx r11, rax, [rsi + 376]
    adcx rax, r10
    mov [rdi + 376],rax

    mulx r10, rax, [rsi + 384]
    adcx rax, r11
    mov [rdi + 384],rax

    mulx r11, rax, [rsi + 392]
    adcx rax, r10
    mov [rdi + 392],rax

    mulx r10, rax, [rsi + 400]
    adcx rax, r11
    mov [rdi + 400],rax

    mulx r11, rax, [rsi + 408]
    adcx rax, r10
    mov [rdi + 408],rax


    mulx r10, rax, [rsi + 416]
    adcx rax, r11
    mov [rdi + 416],rax

    mulx r11, rax, [rsi + 424]
    adcx rax, r10
    mov [rdi + 424],rax

    mulx r10, rax, [rsi + 432]
    adcx rax, r11
    mov [rdi + 432],rax

    mulx r11, rax, [rsi + 440]
    adcx rax, r10
    mov [rdi + 440],rax


    mulx r10, rax, [rsi + 448]
    adcx rax, r11
    mov [rdi + 448],rax

    mulx r11, rax, [rsi + 456]
    adcx rax, r10
    mov [rdi + 456],rax

    mulx r10, rax, [rsi + 464]
    adcx rax, r11
    mov [rdi + 464],rax

    mulx r11, rax, [rsi + 472]
    adcx rax, r10
    mov [rdi + 472],rax

    mulx r10, rax, [rsi + 480]
    adcx rax, r11
    mov [rdi + 480],rax

    mulx r11, rax, [rsi + 488]
    adcx rax, r10
    mov [rdi + 488],rax

    mulx r10, rax, [rsi + 496]
    adcx rax, r11
    mov [rdi + 496],rax

    mulx r11, rax, [rsi + 504]
    adcx rax, r10
    mov [rdi + 504],rax
    ret
